{"hash":"ece696d902eddb330760f1fbd8c4dbd86d186cb1","data":{"markdownPost":{"title":"PostgreSQL INSERT시 TIMESTAMPTZ 컬럼 UTC로 셋팅","content":"<p>테이블생성 DDL</p>\n<pre class=\"language-sql line-numbers\"><code class=\"language-sql\"><span class=\"token keyword\">create</span> <span class=\"token keyword\">table</span> tb_member <span class=\"token punctuation\">(</span>\n\tmember_id uuid <span class=\"token operator\">not</span> <span class=\"token boolean\">null</span><span class=\"token punctuation\">,</span>\n\tmember_name <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">not</span> <span class=\"token boolean\">null</span><span class=\"token punctuation\">,</span>\n\teffective_date timestamptz <span class=\"token operator\">not</span> <span class=\"token boolean\">null</span><span class=\"token punctuation\">,</span>\n\texpiration_date timestamptz <span class=\"token operator\">not</span> <span class=\"token boolean\">null</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token keyword\">primary</span> <span class=\"token keyword\">key</span><span class=\"token punctuation\">(</span>member_id<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"line-numbers-rows\" aria-hidden=\"true\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>글로벌용 프로그램을 개발하다보면 timezone 관련해서 고민이 필요하다.\nexpiration_date 항목에 UTC 9999-12-31 23:59:59.999999 데이터를 집어넣으려고 한다.\n하지만 그냥 insert 할 경우 현재 환경에 셋팅된 시간(나의 경우 GMT+9)으로 들어간다.</p>\n<p>그래서 9999-12-31 23:59:59.999999 이 데이터가 utc라는걸 셋팅해줘야 된다.\n아래의 형태로 형 변환을 하면 된다.</p>\n<pre class=\"language-sql line-numbers\"><code class=\"language-sql\">TO_TIMESTAMP<span class=\"token punctuation\">(</span><span class=\"token string\">'99991231 235959.999999'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'YYYYMMDD HH24MISS.US'</span><span class=\"token punctuation\">)</span>::<span class=\"token keyword\">timestamp</span> without <span class=\"token keyword\">time</span> zone at <span class=\"token keyword\">time</span> zone <span class=\"token string\">'utc'</span><span class=\"line-numbers-rows\" aria-hidden=\"true\"><span></span></span></code></pre>\n<p>최종 SQL INSERT</p>\n<pre class=\"language-sql line-numbers\"><code class=\"language-sql\"><span class=\"token keyword\">insert</span> <span class=\"token keyword\">into</span> tb_member <span class=\"token keyword\">values</span><span class=\"token punctuation\">(</span>gen_random_uuid<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'기본'</span><span class=\"token punctuation\">,</span> <span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> TO_TIMESTAMP<span class=\"token punctuation\">(</span><span class=\"token string\">'99991231 235959.999999'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'YYYYMMDD HH24MISS.US'</span><span class=\"token punctuation\">)</span>::<span class=\"token keyword\">timestamp</span> without <span class=\"token keyword\">time</span> zone at <span class=\"token keyword\">time</span> zone <span class=\"token string\">'utc'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"line-numbers-rows\" aria-hidden=\"true\"><span></span></span></code></pre>\n<p>[참고자료]<br>\n<a href=\"https://stackoverflow.com/questions/42684304/how-to-convert-a-string-to-timestamp-in-a-desired-timezone\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">how to convert a string to timestamp in a desired timezone - stackoverflow</a></p>\n","date":"2022-04-03T17:24:25.000Z","category":["Database","Postgresql"],"lang":"ko"}},"context":{}}